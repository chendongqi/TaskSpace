# 实现任务清单

## 1. 数据模型扩展
- [x] 1.1 在任务数据结构中添加 `priority` 字段(可选, "P0"|"P1"|"P2"|"P3"|undefined)
- [x] 1.2 在任务数据结构中添加 `weeklyGoalId` 字段(可选, string|undefined)
- [x] 1.3 在年度目标数据结构中添加 `priority` 字段
- [x] 1.4 在季度目标数据结构中添加 `priority` 字段
- [x] 1.5 在周目标数据结构中添加 `priority` 字段
- [x] 1.6 在习惯数据结构中添加 `priority` 字段(可选)
- [x] 1.7 验证数据结构向后兼容性

## 2. 数据持久化更新
- [x] 2.1 在 `lib/storage.js` 的任务合并逻辑中处理新字段
- [x] 2.2 在目标合并逻辑中处理优先级字段
- [x] 2.3 更新导出功能以包含新字段
- [x] 2.4 更新导入功能以处理新字段(支持旧版本数据)
- [x] 2.5 验证 LocalStorage 和服务器备份的正确性

## 3. 任务创建 UI 修改
- [x] 3.1 在 `components/add-task-modal.js` 中添加优先级选择器组件
- [x] 3.2 在任务创建表单中添加周目标关联选择器
- [x] 3.3 实现周目标下拉列表(显示当前周的周目标)
- [x] 3.4 添加"无优先级"和"无关联"选项
- [x] 3.5 更新 UI 布局以容纳新控件
- [x] 3.6 确保 UI 风格与现有设计一致
- [x] 3.7 添加优先级和关联的工具提示说明

## 4. 任务列表显示修改
- [x] 4.1 在 `components/task-list.js` 中添加优先级徽章组件
- [x] 4.2 设计优先级徽章样式(优化为带圈数字①②③④，统一灰色)
- [x] 4.3 在任务卡片上显示优先级徽章
- [x] 4.4 添加周目标关联指示器(使用Calendar图标)
- [x] 4.5 添加按优先级排序选项(自动排序：未完成任务按P0>P1>P2>P3排序)
- [x] 4.6 确保所有主题下徽章显示正确
- [x] 4.7 优化任务列表布局（TAG和周目标关联同行显示）

## 5. 目标管理 UI 修改
- [x] 5.1 在 `components/yearly-goals-tracker.js` 中添加优先级选择器
- [x] 5.2 在年度目标卡片上显示优先级徽章
- [x] 5.3 在 `components/quarterly-goals-tracker.js` 中添加优先级选择器
- [x] 5.4 在季度目标卡片上显示优先级徽章
- [x] 5.5 在 `components/weekly-goals-tracker.js` 中添加优先级选择器
- [x] 5.6 在周目标卡片上显示优先级徽章
- [x] 5.7 在目标编辑表单中支持修改优先级(任务编辑支持)

## 6. 主应用逻辑更新
- [x] 6.1 在 `app/page.js` 中更新 addTask 函数以接受优先级和周目标参数
- [x] 6.2 更新年度、季度、周目标创建函数以支持优先级
- [x] 6.3 在数据加载时处理缺失的优先级字段(向后兼容)
- [x] 6.4 确保数据保存包含新字段
- [x] 6.5 验证所有 CRUD 操作正确处理新字段
- [x] 6.6 添加移动端"More"菜单以访问年度/季度目标

## 7. UI/UX 优化
- [x] 7.1 设计统一的优先级徽章组件(可复用)
- [x] 7.2 添加优先级颜色常量定义(优化为统一灰色)
- [x] 7.3 实现优先级图标(改为带圈数字①②③④)
- [x] 7.4 优化移动端优先级选择器布局
- [x] 7.5 优化优先级选择器的选中状态样式(统一使用主色)

## 8. 数据迁移和兼容性
- [x] 8.1 确保没有 priority 字段的任务正常显示
- [x] 8.2 确保没有 weeklyGoalId 的任务正常工作
- [x] 8.3 测试旧版本数据导入功能
- [x] 8.4 测试新旧数据混合场景
- [x] 8.5 验证导出数据格式版本号
- [x] 8.6 修复所有可能导致空key的数据过滤问题

## 9. 功能测试
- [x] 9.1 测试任务创建时设置优先级和周目标关联
- [x] 9.2 测试任务列表中优先级徽章显示
- [x] 9.3 测试周目标关联选择器功能
- [x] 9.4 测试目标创建时设置优先级
- [x] 9.5 测试所有主题下的显示效果
- [x] 9.6 测试深色/浅色模式下的显示
- [x] 9.7 测试响应式布局(移动端、桌面端)
- [x] 9.8 测试任务编辑时修改优先级和周目标关联

## 10. 文档更新
- [x] 10.1 更新 README.md 中的功能描述
- [x] 10.2 更新 CLAUDE.md 中的数据结构文档
- [x] 10.3 添加优先级使用说明
- [x] 10.4 添加周目标关联使用说明

## 11. 性能和优化
- [x] 11.1 验证大量任务时优先级筛选性能(通过过滤无效数据优化)
- [x] 11.2 优化优先级徽章渲染性能
- [x] 11.3 确保数据备份不会因新字段变慢


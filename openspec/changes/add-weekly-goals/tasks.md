# 实现任务清单

## 1. 数据层实现
- [x] 1.1 在 `lib/storage.js` 中添加 `weeklyGoals` 数据合并方法 `mergeWeeklyGoals`
- [x] 1.2 在 `mergeData` 方法的 switch 语句中添加 `weeklyGoals` case
- [x] 1.3 在 `exportAllData` 方法中添加周目标数据导出
- [ ] 1.4 验证数据持久化：LocalStorage 存储和读取
- [ ] 1.5 验证服务器备份：自动备份和恢复机制

## 2. 进度计算逻辑实现
- [x] 2.1 在 `app/page.js` 中实现 `calculateQuarterlyGoalProgress` 函数（根据关联的周目标加权计算季度目标进度）
- [x] 2.2 实现周目标变更时触发季度目标进度更新的机制
- [x] 2.3 实现周目标删除时触发季度目标进度更新的机制
- [x] 2.4 处理权重总和不为 100% 的情况（归一化处理）
- [x] 2.5 处理季度目标没有关联周目标时的手动进度模式
- [x] 2.6 确保季度目标进度更新时触发年度目标进度重新计算（级联更新）

## 3. 周目标 UI 组件实现
- [x] 3.1 创建 `components/weekly-goals-tracker.js` 组件文件
- [x] 3.2 实现周目标列表视图（参考 quarterly-goals-tracker 的布局）
- [x] 3.3 实现添加周目标表单（标题、描述、年份、季度、周数、关联季度目标、权重占比、标签选择）
- [x] 3.4 实现周数筛选器（显示当前季度内的周数，支持周数导航）
- [x] 3.5 实现季度目标关联选择器（下拉选择，显示同年份同季度的季度目标）
- [x] 3.6 实现权重占比输入（0-100，提示当前季度目标已分配的权重）
- [x] 3.7 实现进度条组件（百分比滑块或输入，支持拖动）
- [x] 3.8 实现周目标卡片（显示标题、描述、进度、权重、关联的季度目标、标签、周数）
- [x] 3.9 实现周目标编辑功能
- [x] 3.10 实现周目标删除功能（带确认提示，并说明会影响关联的季度目标进度）
- [x] 3.11 添加动画效果（使用 Framer Motion）
- [x] 3.12 添加音频反馈（目标完成时播放完成音效）

## 4. 季度目标 UI 更新
- [x] 4.1 修改 `components/quarterly-goals-tracker.js`，添加"关联的周目标"显示区域
- [x] 4.2 在季度目标卡片上显示关联的周目标数量
- [x] 4.3 显示进度来源标识（"手动设置" vs "自动计算"）
- [x] 4.4 当季度目标有关联的周目标时，禁用手动进度编辑
- [x] 4.5 添加查看关联周目标的快捷入口（点击后跳转到周目标视图并筛选）

## 5. 主应用集成
- [x] 5.1 在 `app/page.js` 中添加 `weeklyGoals` state
- [x] 5.2 添加 `showWeeklyGoals` modal state
- [x] 5.3 在数据加载 useEffect 中添加周目标加载逻辑
- [x] 5.4 在数据保存 useEffect 中添加周目标保存逻辑
- [x] 5.5 实现 `addWeeklyGoal` 函数（包含进度更新逻辑）
- [x] 5.6 实现 `updateWeeklyGoal` 函数（包含进度更新逻辑）
- [x] 5.7 实现 `deleteWeeklyGoal` 函数（包含进度更新逻辑）
- [x] 5.8 在底部导航栏或设置中添加"周目标"入口按钮
- [x] 5.9 集成 WeeklyGoalsTracker 组件到 AnimatePresence
- [x] 5.10 在 `exportData` 函数中添加周目标导出
- [x] 5.11 在 `importData` 函数中添加周目标导入
- [x] 5.12 添加键盘快捷键（如 Ctrl/Cmd + W）打开周目标

## 6. 样式和主题
- [ ] 6.1 确保周目标组件样式与现有主题系统兼容
- [ ] 6.2 测试深色/浅色模式切换
- [ ] 6.3 测试 4 种主题下的显示效果
- [ ] 6.4 确保响应式设计（移动端和桌面端）
- [ ] 6.5 添加周目标与季度目标的视觉区分

## 7. 测试和验证
- [ ] 7.1 测试周目标的创建、编辑、删除流程
- [ ] 7.2 测试进度更新和可视化
- [ ] 7.3 测试季度目标关联和权重设置
- [ ] 7.4 测试自动进度计算（单个周目标、多个周目标、权重归一化）
- [ ] 7.5 测试权重总和超过或不足 100% 的情况
- [ ] 7.6 测试删除周目标后季度目标进度更新
- [ ] 7.7 测试级联更新（周目标更新 → 季度目标更新 → 年度目标更新）
- [ ] 7.8 测试数据持久化（刷新页面后数据保留）
- [ ] 7.9 测试服务器备份和恢复（隐身模式、新设备）
- [ ] 7.10 测试数据导出和导入功能
- [ ] 7.11 测试键盘快捷键
- [ ] 7.12 测试周数筛选和年份/季度切换功能
- [ ] 7.13 测试标签系统集成
- [ ] 7.14 测试季度目标手动模式和自动模式的切换

## 8. 文档更新
- [ ] 8.1 更新 README.md 添加周目标功能说明
- [ ] 8.2 更新 DATA_MANAGEMENT.md 添加 weeklyGoals 数据说明
- [ ] 8.3 更新 CLAUDE.md 添加周目标数据结构说明
- [ ] 8.4 添加季度目标和周目标关联关系的说明
- [ ] 8.5 添加自动进度计算机制的说明（包括级联更新）

